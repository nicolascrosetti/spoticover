<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spoticover</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Style to keep the canvas aspect ratio square */
        @media (min-width: 1024px) {
            #canvasContainer {
                max-width: 600px; /* Max size on desktop */
                max-height: 600px;
            }
        }
        canvas {
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="spoticover.png">
</head>
<body class="bg-gray-900 text-white font-sans">
    <nav class="bg-gray-950 border-b border-gray-800">
        <div class="max-w-5xl mx-auto px-8 py-4">
            <span class="text-xl font-bold tracking-wide text-green-400">Spoticover</span>
        </div>
    </nav>
    <div class="max-w-5xl mx-auto p-8">
        <h1 class="text-3xl font-bold mb-4 text-center text-green-400">Spotify Playlist Cover Generator</h1>
        <p class="text-gray-400 text-center mb-8">Upload an image, add your title, customize the look, and download your cover.</p>

        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Controls Column -->
            <div class="lg:w-1/2 bg-gray-800 p-6 rounded-lg shadow-xl">
                <h2 class="text-2xl font-bold mb-6">Controls</h2>
                
                <!-- Image Upload -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="imageLoader">Background Image</label>
                    <input type="file" id="imageLoader" accept="image/*" class="block w-full text-xs text-gray-300 file:hover:cursor-pointer
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-green-500 file:text-white
                        hover:file:bg-green-600">
                </div>

                <!-- Title -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="titleInput">Title Text</label>
                    <input type="text" id="titleInput" value="My Playlist" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-green-400">
                </div>
                
                <!-- Bar Color -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="barColorPicker">Color</label>
                    <input type="color" id="barColorPicker" value="#E0B0FF" class="w-full h-12 p-1 bg-gray-700 rounded-lg border border-gray-600 cursor-pointer">
                </div>

                <!-- Title Color -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="titleColorPicker">Title Color</label>
                    <input type="color" id="titleColorPicker" value="#000000" class="w-full h-12 p-1 bg-gray-700 rounded-lg border border-gray-600 cursor-pointer">
                </div>

                <!-- Font Size -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="fontSizeSlider">Font Size (<span id="fontSizeValue">40</span>px)</label>
                    <input type="range" id="fontSizeSlider" min="20" max="120" value="40" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-400">
                </div>

                <!-- Bar Height -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" for="barHeightSlider">Bar Height (<span id="barHeightValue">75</span>px)</label>
                    <input type="range" id="barHeightSlider" min="40" max="200" value="75" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-400">
                </div>
                
                <!-- Download Button -->
                <button id="downloadButton" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-green-600 transition duration-300 ease-in-out">
                    Download Cover
                </button>
            </div>

            <!-- Preview Column -->
            <div class="lg:w-1/2 flex justify-center items-start">
                <div id="canvasContainer" class="w-full bg-black rounded-lg shadow-xl overflow-hidden">
                    <canvas id="coverCanvas" width="600" height="600"></canvas>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        const canvas = document.getElementById('coverCanvas');
        const ctx = canvas.getContext('2d');

        // User Inputs
        const imageLoader = document.getElementById('imageLoader');
        const titleInput = document.getElementById('titleInput');
        const barColorPicker = document.getElementById('barColorPicker');
        const titleColorPicker = document.getElementById('titleColorPicker');
        const downloadButton = document.getElementById('downloadButton');
        const fontSizeSlider = document.getElementById('fontSizeSlider');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const barHeightSlider = document.getElementById('barHeightSlider');
        const barHeightValue = document.getElementById('barHeightValue');

        // Background image (to avoid reloading)
        let backgroundImage = new Image();
        backgroundImage.crossOrigin = "Anonymous"; // To prevent CORS issues if URLs are used
        let imageOffset = { x: 0, y: 0 };
        let imageDrawInfo = null;
        let isDraggingImage = false;
        let dragStartPointer = { x: 0, y: 0 };
        let dragStartOffset = { x: 0, y: 0 };
        let activePointerId = null;

        // Spotify Logo Path so we can recolor it dynamically
        const spotifyLogoPathData = "M32 0C14.3 0 0 14.337 0 32c0 17.7 14.337 32 32 32 17.7 0 32-14.337 32-32S49.663 0 32 0zm14.68 46.184c-.573.956-1.797 1.223-2.753.65-7.532-4.588-16.975-5.62-28.14-3.097-1.07.23-2.14-.42-2.37-1.49s.42-2.14 1.49-2.37c12.196-2.79 22.67-1.606 31.082 3.556a2 2 0 0 1 .688 2.753zm3.9-8.717c-.726 1.185-2.256 1.53-3.44.84-8.602-5.276-21.716-6.805-31.885-3.747-1.338.382-2.714-.344-3.097-1.644-.382-1.338.344-2.714 1.682-3.097 11.622-3.517 26.074-1.835 35.976 4.244 1.147.688 1.49 2.217.765 3.403zm.344-9.1c-10.323-6.117-27.336-6.69-37.2-3.708-1.568.497-3.25-.42-3.747-1.988s.42-3.25 1.988-3.747c11.317-3.44 30.127-2.753 41.98 4.282 1.415.84 1.873 2.676 1.032 4.09-.765 1.453-2.638 1.912-4.053 1.07z";
        const spotifyLogoPath = new Path2D(spotifyLogoPathData);
        const spotifyLogoOriginalSize = 64;
        
        // --- INITIALIZATION ---

        window.onload = () => {
            drawCanvas(); // Draw initial state
        };

        // --- EVENT HANDLERS ---

        // Redraw canvas when any control changes
        imageLoader.addEventListener('change', handleImageUpload);
        titleInput.addEventListener('input', drawCanvas);
        barColorPicker.addEventListener('input', drawCanvas);
        titleColorPicker.addEventListener('input', drawCanvas);
        fontSizeSlider.addEventListener('input', () => {
            fontSizeValue.textContent = fontSizeSlider.value;
            drawCanvas();
        });
        barHeightSlider.addEventListener('input', () => {
            barHeightValue.textContent = barHeightSlider.value;
            drawCanvas();
        });
        canvas.addEventListener('pointerdown', startImageDrag);
        canvas.addEventListener('pointermove', handleImageDrag);
        canvas.addEventListener('pointerup', endImageDrag);
        canvas.addEventListener('pointerleave', endImageDrag);
        canvas.addEventListener('pointercancel', endImageDrag);

        // Download button handler
        downloadButton.addEventListener('click', () => {
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'spotify-cover.png';
            link.href = dataURL;
            link.click();
        });

        // --- HELPER FUNCTIONS ---

        // Load background image
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    backgroundImage.src = event.target.result;
                    backgroundImage.onload = () => {
                        imageOffset = { x: 0, y: 0 };
                        imageDrawInfo = null;
                        updateCanvasCursor();
                        drawCanvas(); // Draw when the image is loaded
                    };
                };
                reader.readAsDataURL(file);
            }
        }

        // --- MAIN DRAW FUNCTION ---

        function drawCanvas() {
            // Get current values
            const title = titleInput.value;
            const barColor = barColorPicker.value;
            const titleColor = titleColorPicker.value;
            const fontSize = fontSizeSlider.value;
            const barHeight = barHeightSlider.value;
            
            // 1. Clear and draw background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Draw background image (if it exists)
            if (backgroundImage.src) {
                // "Cover" style drawing for the image
                const hRatio = canvas.width / backgroundImage.width;
                const vRatio = canvas.height / backgroundImage.height;
                const ratio = Math.max(hRatio, vRatio); // Fills the canvas
                const scaledWidth = backgroundImage.width * ratio;
                const scaledHeight = backgroundImage.height * ratio;
                const centerShift_x = (canvas.width - scaledWidth) / 2;
                const centerShift_y = (canvas.height - scaledHeight) / 2;

                imageDrawInfo = {
                    scaledWidth,
                    scaledHeight,
                    centerShiftX: centerShift_x,
                    centerShiftY: centerShift_y
                };
                clampImageOffset();

                ctx.drawImage(
                    backgroundImage,
                    0, 0, backgroundImage.width, backgroundImage.height,
                    centerShift_x + imageOffset.x,
                    centerShift_y + imageOffset.y,
                    scaledWidth,
                    scaledHeight
                );
            } else {
                imageDrawInfo = null;
                updateCanvasCursor();
            }

            // 3. Draw the color bar (with the gap)
            ctx.fillStyle = barColor;
            
            // Save state for transparency
            ctx.save();
            ctx.globalAlpha = 0.95; // 85% opacity

            const bottomMargin = 30; // Bottom margin (10px higher than before)
            const numericBarHeight = parseInt(barHeight, 10);
            const barY = canvas.height - numericBarHeight - bottomMargin;
            
            const leftBarWidth = 20;
            const gapWidth = 20; // 20px gap
            const mainBarX = leftBarWidth + gapWidth;
            const mainBarWidth = canvas.width - mainBarX;

            // Draw left bar
            ctx.fillRect(0, barY, leftBarWidth, numericBarHeight);
            // Draw main bar
            ctx.fillRect(mainBarX, barY, mainBarWidth, numericBarHeight);

            // Restore state after drawing transparent bars
            ctx.restore();
            
            // 4. Draw the Title
            ctx.fillStyle = titleColor;
            ctx.font = `bold ${fontSize}px "Inter", sans-serif`;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';

            const textPadding = 20; // Padding from the left edge of the bar
            const titleX = mainBarX + textPadding;
            const titleY = barY + (numericBarHeight / 2);
            
            // Max width to prevent text overflow
            const maxWidth = mainBarWidth - (textPadding * 2); 
            
            ctx.fillText(title, titleX, titleY, maxWidth);

            // 5. Draw Spotify logo tinted with the bar color
            const logoSize = 40;
            const logoPadding = 20;
            const logoScale = logoSize / spotifyLogoOriginalSize;
            ctx.save();
            ctx.translate(logoPadding, logoPadding);
            ctx.scale(logoScale, logoScale);
            ctx.fillStyle = barColor;
            ctx.fill(spotifyLogoPath);
            ctx.restore();

            updateCanvasCursor();
        }

        // --- IMAGE DRAG HELPERS ---

        function getCanvasCoordinates(event) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return {
                x: (event.clientX - rect.left) * scaleX,
                y: (event.clientY - rect.top) * scaleY
            };
        }

        function clampImageOffset() {
            if (!imageDrawInfo) return;
            const maxOffsetX = Math.max(0, (imageDrawInfo.scaledWidth - canvas.width) / 2);
            const maxOffsetY = Math.max(0, (imageDrawInfo.scaledHeight - canvas.height) / 2);
            imageOffset.x = Math.min(maxOffsetX, Math.max(-maxOffsetX, imageOffset.x));
            imageOffset.y = Math.min(maxOffsetY, Math.max(-maxOffsetY, imageOffset.y));
        }

        function startImageDrag(event) {
            if (!backgroundImage.src) return;
            isDraggingImage = true;
            activePointerId = event.pointerId;
            if (canvas.setPointerCapture) {
                canvas.setPointerCapture(activePointerId);
            }
            dragStartPointer = getCanvasCoordinates(event);
            dragStartOffset = { ...imageOffset };
            updateCanvasCursor();
            event.preventDefault();
        }

        function handleImageDrag(event) {
            if (!isDraggingImage) return;
            const currentPos = getCanvasCoordinates(event);
            const deltaX = currentPos.x - dragStartPointer.x;
            const deltaY = currentPos.y - dragStartPointer.y;
            imageOffset.x = dragStartOffset.x + deltaX;
            imageOffset.y = dragStartOffset.y + deltaY;
            clampImageOffset();
            drawCanvas();
            canvas.style.cursor = 'grabbing';
            event.preventDefault();
        }

        function endImageDrag() {
            if (!isDraggingImage) return;
            isDraggingImage = false;
            if (activePointerId !== null && canvas.releasePointerCapture) {
                canvas.releasePointerCapture(activePointerId);
                activePointerId = null;
            }
            updateCanvasCursor();
        }

        function updateCanvasCursor() {
            if (!backgroundImage.src) {
                canvas.style.cursor = 'default';
            } else {
                canvas.style.cursor = isDraggingImage ? 'grabbing' : 'grab';
            }
        }
    </script>

</body>
</html>
